{# templates/account/password.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Change password{% endblock %}

{% block body %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 m-0">ğŸ” Change password</h1>
    <a href="{{ path('app_account') }}" class="btn btn-sm btn-outline-light rounded-1">â† Back to account</a>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card bg-dark border-secondary rounded-2">
        <div class="card-header border-secondary">
          <span class="fw-semibold">Update your password</span>
        </div>
        <div class="card-body">

          {# Flash messages #}
          {% for label, messages in app.flashes %}
            {% for message in messages %}
              <div class="alert alert-{{ label }} small py-2 mb-2">
                {{ message }}
              </div>
            {% endfor %}
          {% endfor %}

          {{ form_start(passwordForm, { attr: { class: 'vstack gap-3', 'data-turbo': 'false' } }) }}

            {# Current password #}
            <div>
              <label class="form-label small mb-1">Current password</label>
              <div class="input-group input-group-sm">
                {{ form_widget(passwordForm.currentPassword, {
                  attr: passwordForm.currentPassword.vars.attr|merge({
                    class: 'form-control',
                    autocomplete: 'current-password'
                  })
                }) }}
                <button type="button"
                        class="btn btn-outline-secondary border-start-0 js-toggle-password">
                  ğŸ‘
                </button>
              </div>
              <div class="form-text text-secondary small">
                Enter your existing password to confirm itâ€™s really you.
              </div>
              {{ form_errors(passwordForm.currentPassword) }}
            </div>

            {# New password #}
            <div>
              <label class="form-label small mb-1">New password</label>
              <div class="input-group input-group-sm">
                {{ form_widget(passwordForm.newPassword, {
                  attr: passwordForm.newPassword.vars.attr|merge({
                    class: 'form-control',
                    autocomplete: 'new-password'
                  })
                }) }}
                <button type="button"
                        class="btn btn-outline-secondary border-start-0 js-toggle-password">
                  ğŸ‘
                </button>
              </div>
              <div class="form-text text-secondary small">
                Use at least 8 characters. Donâ€™t reuse your current password.
              </div>
              {{ form_errors(passwordForm.newPassword) }}
            </div>

            {# Confirm new password #}
            <div>
              <label class="form-label small mb-1">Confirm new password</label>
              <div class="input-group input-group-sm">
                {{ form_widget(passwordForm.confirmNewPassword, {
                  attr: passwordForm.confirmNewPassword.vars.attr|merge({
                    class: 'form-control',
                    autocomplete: 'new-password'
                  })
                }) }}
                <button type="button"
                        class="btn btn-outline-secondary border-start-0 js-toggle-password">
                  ğŸ‘
                </button>
              </div>
              {{ form_errors(passwordForm.confirmNewPassword) }}
            </div>

            <div class="d-flex gap-2 pt-2">
              <button class="btn btn-primary btn-sm rounded-1">
                Save new password
              </button>
              <a href="{{ path('app_account') }}"
                 class="btn btn-outline-light btn-sm rounded-1">
                Cancel
              </a>
            </div>

          {{ form_end(passwordForm) }}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Simple eye toggle for all three fields
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.js-toggle-password').forEach(btn => {
    btn.addEventListener('click', () => {
      const group = btn.closest('.input-group');
      if (!group) return;
      const input = group.querySelector('input');
      if (!input) return;

      const isPassword = input.type === 'password';
      input.type = isPassword ? 'text' : 'password';
      btn.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘';
    });
  });
});
</script>
{% endblock %}
