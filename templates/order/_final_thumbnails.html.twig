<div class="card bg-dark border-0 p-3 mb-4">
  <div class="d-flex align-items-center justify-content-between mb-2">
    <div class="small text-secondary">Final thumbnails</div>

    {% if is_granted('ROLE_ADMIN') %}
      <form class="d-flex gap-2" method="post" enctype="multipart/form-data"
            action="{{ path('app_thumbnail_upload', { id: order.id, back: app.request.uri }) }}">
        <input type="hidden" name="_token" value="{{ csrf_token('thumb-upload' ~ order.id) }}">
        <input class="form-control form-control-sm" type="file" name="thumb_files[]" accept="image/png,image/jpeg,image/webp" multiple required>
        <button class="btn btn-sm btn-primary rounded-1">Upload</button>
      </form>
    {% endif %}
  </div>

  {% set thumbs = order.thumbnails %}
  {% if thumbs|length == 0 %}
    <div class="text-secondary">No final thumbnails yet.</div>
  {% else %}
    <div class="row g-3">
      {% for a in thumbs %}
        <div class="col-6 col-md-3">
          <div class="bg-dark border rounded-1 p-2 h-100 d-flex flex-column">
            <a href="{{ asset('uploads/order-thumbnails/' ~ a.fileName) }}" target="_blank" class="mb-2">
              <img src="{{ asset('uploads/order-thumbnails/' ~ a.fileName) | imagine_filter('thumb_320x180') }}"
                   alt="Thumbnail {{ loop.index }}" class="img-fluid rounded-1"
                   loading="lazy" style="aspect-ratio:16/9;object-fit:cover;">
            </a>
            <div class="small text-secondary mb-2">{{ (a.fileSize/1024)|number_format(0, ',', ' ') }} KB</div>

            <div class="mt-auto d-flex gap-2">
              <a class="btn btn-sm btn-outline-light rounded-1" href="{{ path('app_thumbnail_download', { id: a.id }) }}">Download</a>

              {% if is_granted('ROLE_ADMIN') %}
                <form method="post" action="{{ path('app_thumbnail_delete', { id: a.id, back: app.request.uri }) }}"
                      onsubmit="return confirm('Delete this final thumbnail?');">
                  <input type="hidden" name="_token" value="{{ csrf_token('thumb-delete' ~ a.id) }}">
                  <button class="btn btn-sm btn-outline-danger rounded-1">Delete</button>
                </form>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
