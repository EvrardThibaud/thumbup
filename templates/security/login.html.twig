{# templates/security/login.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Log in!{% endblock %}

{% block body %}
<div class="mt-4 mx-auto" style="max-width: 420px;">
  <div class="card bg-dark border-0 p-4 shadow-sm">
    <h1 class="h4 mb-3 text-center">Please sign in</h1>

    {% if error %}
      <div class="alert alert-danger small mb-3">
        {{ error.messageKey|trans(error.messageData, 'security') }}
      </div>
    {% endif %}

    {% if app.user %}
      <div class="mb-3 small">
        You are logged in as {{ app.user.userIdentifier }},
        <a href="{{ path('app_logout') }}">Logout</a>
      </div>
    {% endif %}

    <form method="post" class="vstack gap-3">
      <div>
        <label for="inputEmail" class="form-label mb-1">Email</label>
        <input type="email"
               value="{{ last_username }}"
               name="email"
               id="inputEmail"
               class="form-control"
               autocomplete="email"
               required
               autofocus>
      </div>

      <div>
        <label for="inputPassword" class="form-label mb-1">Password</label>
        <div class="input-group">
          <input type="password"
                 name="password"
                 id="inputPassword"
                 class="form-control"
                 autocomplete="current-password"
                 required>
          <button class="btn btn-outline-light border-secondary" type="button" id="togglePassword">
            üëÅ
          </button>
        </div>
      </div>

      <input type="hidden"
             name="_csrf_token"
             data-controller="csrf-protection"
             value="{{ csrf_token('authenticate') }}">

      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="_remember_me" id="remember_me">
        <label class="form-check-label" for="remember_me">
          Remember me
        </label>
      </div>

      <button class="btn btn-primary w-100" type="submit">
        Sign in
      </button>

      <div class="text-center">
        <a href="{{ path('app_forgot_password_request') }}" class="small text-secondary">
          Forgot your password?
        </a>
      </div>
    </form>
  </div>
</div>

<script>
(function () {
  function initLoginPasswordToggle() {
    const pwd = document.getElementById('inputPassword');
    const btn = document.getElementById('togglePassword');

    if (!pwd || !btn) {
      return;
    }

    if (btn.dataset.bound === '1') {
      return;
    }
    btn.dataset.bound = '1';

    btn.addEventListener('click', function (e) {
      e.preventDefault();
      const isPassword = pwd.type === 'password';
      pwd.type = isPassword ? 'text' : 'password';
      btn.textContent = isPassword ? 'üôà' : 'üëÅ';
    });
  }

  document.addEventListener('DOMContentLoaded', initLoginPasswordToggle);
  document.addEventListener('turbo:load', initLoginPasswordToggle);
})();
</script>
{% endblock %}
