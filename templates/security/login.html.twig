{# templates/security/login.html.twig (version with "Forgot password" link + show password) #}
{% extends 'base.html.twig' %}

{% block title %}Log in!{% endblock %}

{% block body %}
<form method="post" class="mt-5 mx-auto" style="max-width: 400px;">
    {% if error %}
        <div class="alert alert-danger small mb-3">
            {{ error.messageKey|trans(error.messageData, 'security') }}
        </div>
    {% endif %}

    {% if app.user %}
        <div class="mb-3 small">
            You are logged in as {{ app.user.userIdentifier }}, <a href="{{ path('app_logout') }}">Logout</a>
        </div>
    {% endif %}

    <h1 class="h4 mb-3">Please sign in</h1>

    <div class="mb-2">
        <label for="inputEmail" class="form-label small mb-1">Email</label>
        <input type="email"
               value="{{ last_username }}"
               name="email"
               id="inputEmail"
               class="form-control form-control-sm"
               autocomplete="email"
               required
               autofocus>
    </div>

    <div class="mb-2">
        <label for="inputPassword" class="form-label small mb-1">Password</label>
        <div class="input-group input-group-sm">
            <input type="password"
                   name="password"
                   id="inputPassword"
                   class="form-control form-control-sm"
                   autocomplete="current-password"
                   required>
            <button class="btn btn-outline-light border-secondary" type="button" id="togglePassword">
                üëÅ
            </button>
        </div>
    </div>

    <input type="hidden" name="_csrf_token" data-controller="csrf-protection" value="{{ csrf_token('authenticate') }}">

    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" name="_remember_me" id="remember_me">
        <label class="form-check-label small" for="remember_me">
            Remember me
        </label>
    </div>

    <button class="btn btn-primary btn-sm w-100" type="submit">
        Sign in
    </button>

    <div class="mt-3 text-center">
        <a href="{{ path('app_forgot_password_request') }}" class="small text-secondary">
            Forgot your password?
        </a>
    </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const pwd = document.getElementById('inputPassword');
    const btn = document.getElementById('togglePassword');
    if (!pwd || !btn) return;

    btn.addEventListener('click', function () {
      const isPassword = pwd.type === 'password';
      pwd.type = isPassword ? 'text' : 'password';
      btn.textContent = isPassword ? 'üôà' : 'üëÅ';
    });
  });
</script>
{% endblock %}
