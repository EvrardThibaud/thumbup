{% extends 'base.html.twig' %}
{% block title %}Users{% endblock %}

{% block body %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h4 m-0">ðŸ‘¥ Users</h1>
</div>

<div class="card bg-dark border-0 p-3">
  <div class="table-responsive">
    <table class="table table-dark table-hover align-middle mb-0">
      <thead class="small text-secondary">
        <tr>
          <th>ID</th>
          <th>Email</th>
          <th>Roles</th>
          <th>Client</th>
          <th>Verified</th>
          <th>Created</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% set tz = app.user ? app.user.timezone : 'Europe/Paris' %}
      {% for u in users %}
        <tr class="table-row-link"
            data-href="{{ path('app_user_show', {id: u.id}) }}"
            style="cursor:pointer">
          <td class="text-secondary">#{{ u.id }}</td>
          <td class="fw-medium">{{ u.email }}</td>
          <td>
            {% for r in u.roles %}
              <span class="badge text-bg-{{ r == 'ROLE_ADMIN' ? 'primary' : (r == 'ROLE_CLIENT' ? 'success' : 'secondary') }} rounded-1">{{ r }}</span>
            {% endfor %}
          </td>
          <td>
            {% if u.client %}
              <a class="link-light link-opacity-75-hover"
                 href="{{ path('app_client_show', {id: u.client.id}) }}"
                 onclick="event.stopPropagation()">
                {{ u.client.name }}
              </a>
            {% else %}â€”{% endif %}
          </td>
          <td>
            {% if u.isVerified %}
              <span class="badge text-bg-success rounded-1">Yes</span>
            {% else %}
              <span class="badge text-bg-secondary rounded-1">No</span>
            {% endif %}
          </td>
          <td class="text-secondary">{{ u.createdAt|date('Y-m-d H:i', tz) }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-light rounded-1"
               href="{{ path('app_user_edit', {id: u.id, back: app.request.uri}) }}"
               onclick="event.stopPropagation()">
              Edit
            </a>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="7" class="text-secondary">No users.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  document.addEventListener('click', function (e) {
    const row = e.target.closest('.table-row-link');
    if (row && !e.target.closest('a, button, input, form')) {
      const href = row.getAttribute('data-href');
      if (href) {
        window.location = href;
      }
    }
  });
</script>
{% endblock %}
