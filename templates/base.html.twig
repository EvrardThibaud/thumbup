<!DOCTYPE html>
<html data-bs-theme="dark">
  <head>
    <meta charset="UTF-8">
    <title>{% block title %}Welcome!{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">

    {% block stylesheets %}
    <style>
      .toast-container {
        display: flex;
        flex-direction: column;
        align-items: center; /* centre les toasts dans le conteneur */
      }

      .toast-container .toast {
        min-width: 260px;
        max-width: 420px;
      }
    </style>
    {% endblock %}

    {% block javascripts %}
      {% block importmap %}{{ importmap('app') }}{% endblock %}
    {% endblock %}
  </head>
  <body>
    {% include '_nav.html.twig' %}

    <main class="container-xxl py-4">

      {# --- Bootstrap toasts simples, sans croix --- #}
      <div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 1080;">
        <div class="toast-container">

          {% for label, messages in app.flashes %}
            {% set tone = {
              'success':'success',
              'warning':'warning',
              'danger':'danger',
              'error':'danger',
              'info':'info'
            }[label]|default('secondary') %}

            {% for message in messages %}
              <div class="toast align-items-center text-bg-{{ tone }} border-0 mt-2"
                   role="alert"
                   aria-live="assertive"
                   aria-atomic="true"
                   data-bs-autohide="true"
                   data-bs-delay="4000">
                <div class="d-flex">
                  <div class="toast-body">
                    {{ message|raw }}
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endfor %}

        </div>
      </div>

      <script>
        (function () {
          function showToasts() {
            document.querySelectorAll('.toast').forEach(function (el) {
              bootstrap.Toast.getOrCreateInstance(el).show();
            });
          }
          document.addEventListener('DOMContentLoaded', showToasts);
          document.addEventListener('turbo:load', showToasts);
        })();
      </script>

      <script>
        document.addEventListener('click', (e) => {
          const row = e.target.closest('tr[data-href]');
          if (!row) return;
          if (e.target.closest('a, button, input, select, textarea, label')) return;
          window.location.href = row.dataset.href;
        });
      </script>

      {% block body %}{% endblock %}
    </main>
  </body>
</html>
