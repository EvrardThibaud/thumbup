{% extends 'base.html.twig' %}
{% block title %}Checkout{% endblock %}

{% block body %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 m-0">üßæ Checkout</h1>
    <a class="btn btn-sm btn-outline-light rounded-1" href="{{ path('app_payments_index') }}">‚Üê Back to selection</a>
  </div>

  <div class="card bg-dark border-0 mb-3">
    <div class="card-body">
      <ol class="steps list-unstyled d-flex justify-content-between m-0">
        <li class="step" data-step="1"><span class="dot">1</span><span class="label">Summary</span></li>
        <li class="sep flex-grow-1 align-self-center mx-2"></li>
        <li class="step" data-step="2"><span class="dot">2</span><span class="label">Payment</span></li>
      </ol>
    </div>
  </div>

  <div id="step-1" class="card bg-dark border-0 mb-3">
    <div class="card-header border-0"><span class="fw-semibold">Selected orders</span></div>
    <div class="card-body">
      <ul class="list-group list-group-flush">
        {% for o in orders %}
          <li class="list-group-item bg-dark text-light d-flex justify-content-between">
            <span class="text-truncate me-3">{{ o.title }}</span>
            <span class="font-monospace">‚Ç¨ {{ (o.price/100)|number_format(2, ',', ' ') }}</span>
          </li>
        {% endfor %}
      </ul>
      <div class="d-flex justify-content-end align-items-center gap-2 mt-3">
        <span class="text-secondary small">Total</span>
        <span class="badge text-bg-light text-dark font-monospace">‚Ç¨ {{ (totalCents/100)|number_format(2, ',', ' ') }}</span>
      </div>
      <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-primary rounded-1" id="go-step-2">Next</button>
      </div>
    </div>
  </div>

  <div id="step-2" class="card bg-dark border-0 mb-3" hidden>
    <div class="card-header border-0"><span class="fw-semibold">Pay with PayPal</span></div>
    <div class="card-body">
      <p class="text-secondary small mb-3">
        You‚Äôll be redirected to PayPal to complete your payment, then back to ThumbUp.
      </p>

      <form method="post"
            action="{{ path('app_payments_checkout_paypal_create') }}"
            data-turbo="false"
            class="mb-3">
        <button class="btn btn-paypal w-100 rounded-1" type="submit">
          <span class="paypal-logo">
            <span class="paypal-p">Pay</span><span class="paypal-pal">Pal</span>
          </span>
        </button>
      </form>

      <button type="button" class="btn btn-outline-light rounded-1" id="back-step-1">Back</button>
    </div>
  </div>
</div>

<style>
.steps .step {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  opacity: 0.6;
}

.steps .step.active {
  opacity: 1;
}

.steps .dot {
  display: inline-flex;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  align-items: center;
  justify-content: center;
  background: #0d6efd;
}

.steps .label {
  font-weight: 600;
}

.steps .sep {
  height: 2px;
  background: rgba(255, 255, 255, 0.15);
}

.btn-paypal{
  background:#ffc439;
  color:#111;
  border:none;
  font-weight:600;
  font-size:.95rem;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:.45rem .75rem;
}
.btn-paypal:hover{
  background:#ffb820;
  color:#111;
}
.paypal-logo{
  display:inline-flex;
  align-items:baseline;
  gap:.15rem;
}
.paypal-p{font-weight:700;}
.paypal-pal{font-weight:500;}
</style>

<script>
(function(){
  const s1=document.getElementById('step-1'),
        s2=document.getElementById('step-2'),
        go2=document.getElementById('go-step-2'),
        back1=document.getElementById('back-step-1'),
        steps=document.querySelectorAll('.steps .step');

  function setStep(n){
    if(s1) s1.hidden = n!==1;
    if(s2) s2.hidden = n!==2;
    steps.forEach(li=>li.classList.toggle('active', li.dataset.step === String(n)));
  }

  go2?.addEventListener('click', ()=>setStep(2));
  back1?.addEventListener('click', ()=>setStep(1));

  const initial = {{ step|default(1) }};
  setStep(initial === 2 ? 2 : 1);
})();
</script>
{% endblock %}
