{% block title %}Admin dashboard{% endblock %}

{% block body %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 m-0">ðŸ“Š Admin dashboard</h1>

    <form method="get"
          action="{{ path('app_dashboard') }}"
          class="d-flex align-items-center gap-2">

      {# Client filter #}
      <select name="client"
              class="form-select form-select-sm bg-dark text-light border-secondary">
        <option value="" {{ selectedClient is not defined or selectedClient is null ? 'selected':'' }}>
          All clients
        </option>
        {% for c in clients %}
          <option value="{{ c.id }}" {{ selectedClient and selectedClient.id == c.id ? 'selected':'' }}>
            {{ c.name }}
          </option>
        {% endfor %}
      </select>

      {# Time range filter #}
      <select name="range"
              class="form-select form-select-sm bg-dark text-light border-secondary">
        <option value="all"   {{ range == 'all'   ? 'selected':'' }}>All time</option>
        <option value="year"  {{ range == 'year'  ? 'selected':'' }}>Last year</option>
        <option value="month" {{ range == 'month' ? 'selected':'' }}>Last month</option>
        <option value="week"  {{ range == 'week'  ? 'selected':'' }}>Last week</option>
      </select>

      <button class="btn btn-sm btn-outline-light rounded-1" type="submit">
        Apply
      </button>

      {% if selectedClient or range != 'year' %}
        <a class="btn btn-sm btn-outline-secondary rounded-1"
           href="{{ path('app_dashboard') }}">
          Reset
        </a>
      {% endif %}
    </form>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card bg-dark border-0 p-3 h-100">
        <div class="small text-secondary mb-1">Total time ({{ periodLabel }})</div>
        <div class="fs-3">{{ totalMinutes|default(0) }} min</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark border-0 p-3 h-100">
        <div class="small text-secondary mb-1">Total revenue ({{ periodLabel }})</div>
        <div class="fs-3">
          {{ totalRevenue|number_format(2, ',', ' ') }} â‚¬
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark border-0 p-3 h-100">
        <div class="small text-secondary mb-1">Total thumbnails ({{ periodLabel }})</div>
        <div class="fs-3">{{ totalOrders|default(0) }}</div>
      </div>
    </div>
  </div>

  {# Charts #}
  {% set unitLabel = (range in ['month','week']) ? 'day' : 'month' %}

  <div class="row g-3">
    <div class="col-lg-6">
      <div class="card bg-dark border-secondary mb-3">
        <div class="card-header border-secondary">
          <span class="fw-semibold">Thumbnails per {{ unitLabel }}</span>
        </div>
        <div class="card-body">
          {{ render_chart(ordersChart, { height: 120 }) }}
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card bg-dark border-secondary mb-3">
        <div class="card-header border-secondary">
          <span class="fw-semibold">Time spent per {{ unitLabel }} (min)</span>
        </div>
        <div class="card-body">
          {{ render_chart(timeChart, { height: 120 }) }}
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card bg-dark border-secondary mb-3">
        <div class="card-header border-secondary">
          <span class="fw-semibold">Revenue per {{ unitLabel }} (â‚¬)</span>
        </div>
        <div class="card-body">
          {{ render_chart(revenueChart, { height: 120 }) }}
        </div>
      </div>
    </div>
  </div>
</div>
 {% if cumOrdersChart and cumRevenueChart %}
    <div class="mt-4">
      <div class="card bg-dark border-secondary">
        <div class="card-header border-secondary d-flex justify-content-between align-items-center">
          <span class="fw-semibold">Cumulative overview (all time)</span>
          <span class="small text-secondary">Unit: month Â· No filters applied</span>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-lg-6">
              {{ render_chart(cumOrdersChart, { height: 120 }) }}
            </div>
            <div class="col-lg-6">
              {{ render_chart(cumRevenueChart, { height: 120 }) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
